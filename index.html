<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>G.K GAME</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #e3f2fd;
    margin: 0; padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #222;
    user-select: none;
    min-height: 100vh;
    box-sizing: border-box;
    position: relative;
  }
  h1 {
    margin-bottom: 30px;
    color: #1565c0;
    font-size: 2.5rem;
    text-align: center;
  }
  #modeSelection {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  #modeSelection button {
    padding: 15px 35px;
    font-size: 1.3rem;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    color: white;
    background: #1565c0;
    box-shadow: 0 4px 8px rgb(21 101 192 / 0.7);
    user-select: none;
    transition: background-color 0.25s ease;
  }
  #modeSelection button:hover {
    background: #0d47a1;
  }

  #offlinePopup {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(187, 222, 251, 0.95);
    z-index: 1000;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 20px;
    box-sizing: border-box;
  }
  #offlinePopup button {
    width: 220px;
    padding: 18px;
    font-size: 1.3rem;
    font-weight: 600;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    color: white;
    background: #1565c0;
    box-shadow: 0 4px 8px rgb(21 101 192 / 0.7);
    user-select: none;
    transition: background-color 0.25s ease;
  }
  #offlinePopup button:hover {
    background: #0d47a1;
  }

  #game {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  #board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-template-rows: repeat(3, 100px);
    gap: 10px;
  }

  .cell {
    width: 100px;
    height: 100px;
    background: #bbdefb;
    border-radius: 12px;
    font-size: 3.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    color: #1565c0;
    user-select: none;
    box-shadow: inset 0 0 5px #90caf9;
    transition: background-color 0.3s ease;
  }

  .cell:hover {
    background-color: #90caf9;
  }

  #status {
    font-size: 1.5rem;
    color: #0d47a1;
    font-weight: 600;
  }

  #restartBtn {
    background: #1565c0;
    color: white;
    padding: 10px 25px;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 4px 8px rgb(21 101 192 / 0.7);
    transition: background-color 0.3s ease;
    user-select: none;
  }

  #restartBtn:hover {
    background: #0d47a1;
  }

  #endGamePopup {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(21, 101, 192, 0.9);
    color: white;
    font-weight: 700;
    font-size: 2rem;
    z-index: 1500;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 25px;
  }

  #endGamePopup button {
    width: 180px;
    padding: 14px;
    font-size: 1.25rem;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #bbdefb;
    color: #1565c0;
    user-select: none;
    transition: background-color 0.3s ease;
  }

  #endGamePopup button:hover {
    background-color: #90caf9;
  }

  footer {
    position: absolute;
    bottom: 10px;
    width: 100%;
    text-align: center;
    font-size: 0.9rem;
    font-weight: 600;
    color: #1565c0;
    user-select: none;
  }

  @media (max-width: 400px) {
    h1 {
      font-size: 1.8rem;
    }
    #modeSelection button, #offlinePopup button, #endGamePopup button {
      width: 150px;
      padding: 12px;
      font-size: 1rem;
    }
    #board {
      grid-template-columns: repeat(3, 70px);
      grid-template-rows: repeat(3, 70px);
      gap: 8px;
    }
    .cell {
      width: 70px;
      height: 70px;
      font-size: 2.5rem;
    }
  }
</style>
</head>
<body>

<h1>Welcome to Tic Tac Toe</h1>

<div id="modeSelection">
  <button id="btnOffline" onclick="clickSound(); selectOffline()">Offline</button>
  <button id="btnOnline" onclick="clickSound(); selectOnline()">Online</button>
</div>

<div id="offlinePopup">
  <h2 style="color:#1565c0; margin-bottom:20px;">Choose Offline Mode</h2>
  <button onclick="clickSound(); startOfflineGame('2player')">2 Player</button>
  <button onclick="clickSound(); startOfflineGame('computer')">Computer</button>
</div>

<div id="game">
  <div id="status">Player X's turn</div>
  <div id="board">
    <!-- 9 cells -->
    <div class="cell" data-index="0"></div>
    <div class="cell" data-index="1"></div>
    <div class="cell" data-index="2"></div>
    <div class="cell" data-index="3"></div>
    <div class="cell" data-index="4"></div>
    <div class="cell" data-index="5"></div>
    <div class="cell" data-index="6"></div>
    <div class="cell" data-index="7"></div>
    <div class="cell" data-index="8"></div>
  </div>
</div>

<!-- End game popup -->
<div id="endGamePopup">
  <div id="endGameMessage"></div>
  <div>
    <button id="playAgainBtn">Play Again</button>
    <button id="exitBtn">Exit</button>
  </div>
</div>

<footer>Created by G.K</footer>

<audio id="clickAudio" src="select-001-337218.mp3" preload="auto"></audio>

<script>
  let mode = null; // '2player' or 'computer'
  let board = ["", "", "", "", "", "", "", "", ""];
  let currentPlayer = "X";
  let gameActive = false;

  const statusDisplay = document.getElementById('status');
  const boardElem = document.getElementById('board');
  const cells = document.querySelectorAll('.cell');
  const gameDiv = document.getElementById('game');
  const offlinePopup = document.getElementById('offlinePopup');
  const modeSelection = document.getElementById('modeSelection');

  const endGamePopup = document.getElementById('endGamePopup');
  const endGameMessage = document.getElementById('endGameMessage');
  const playAgainBtn = document.getElementById('playAgainBtn');
  const exitBtn = document.getElementById('exitBtn');

  const clickAudio = document.getElementById('clickAudio');

  function clickSound() {
    clickAudio.currentTime = 0;
    clickAudio.play();
  }

  function selectOffline() {
    modeSelection.style.display = 'none';
    offlinePopup.style.display = 'flex';
  }

  function selectOnline() {
    modeSelection.style.display = 'none';
    window.location.href = 'about.html';
  }

  function startOfflineGame(selectedMode) {
    mode = selectedMode;
    offlinePopup.style.display = 'none';
    gameDiv.style.display = 'flex';
    resetBoard();
    gameActive = true;
    currentPlayer = "X";
    updateStatus(`Player ${currentPlayer}'s turn`);
    if (mode === 'computer' && currentPlayer === "O") {
      // If computer starts first (optional), make computer move
      computerMove();
    }
  }

  function resetBoard() {
    board = ["", "", "", "", "", "", "", "", ""];
    cells.forEach(cell => {
      cell.textContent = "";
      cell.style.pointerEvents = "auto";
    });
  }

  function updateStatus(message) {
    statusDisplay.textContent = message;
  }

  function handleCellClick(e) {
    if (!gameActive) return;

    const index = e.target.getAttribute('data-index');
    if (board[index] !== "") return;

    makeMove(index, currentPlayer);

    if (checkWinner(board, currentPlayer)) {
      showEndGamePopup(`Player ${currentPlayer} wins!`);
      endGame();
      return;
    }

    if (isDraw()) {
      showEndGamePopup(`It's a draw!`);
      endGame();
      return;
    }

    // Switch player
    currentPlayer = currentPlayer === "X" ? "O" : "X";
    updateStatus(`Player ${currentPlayer}'s turn`);

    if (mode === 'computer' && currentPlayer === "O" && gameActive) {
      boardElem.style.pointerEvents = "none";
      setTimeout(() => {
        computerMove();
        boardElem.style.pointerEvents = "auto";
      }, 600);
    }
  }

  function makeMove(index, player) {
    board[index] = player;
    cells[index].textContent = player;
  }

  function checkWinner(bd, player) {
    const winConditions = [
      [0,1,2], [3,4,5], [6,7,8], // rows
      [0,3,6], [1,4,7], [2,5,8], // cols
      [0,4,8], [2,4,6]           // diagonals
    ];
    return winConditions.some(condition => 
      condition.every(i => bd[i] === player)
    );
  }

  function isDraw() {
    return board.every(cell => cell !== "");
  }

  function endGame() {
    gameActive = false;
    cells.forEach(cell => cell.style.pointerEvents = "none");
  }

  function restartGame() {
    clickSound();
    resetBoard();
    gameActive = true;
    currentPlayer = "X";
    updateStatus(`Player ${currentPlayer}'s turn`);
    endGamePopup.style.display = "none";
  }

  function showEndGamePopup(message) {
    endGameMessage.textContent = message;
    endGamePopup.style.display = "flex";
  }

  function computerMove() {
    let availableIndices = board.map((v,i) => v === "" ? i : null).filter(v => v !== null);

    if (availableIndices.length === 0) return;

    // Basic AI: random choice
    const moveIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
    makeMove(moveIndex, currentPlayer);

    if (checkWinner(board, currentPlayer)) {
      showEndGamePopup(`Computer wins!`);
      endGame();
      return;
    }

    if (isDraw()) {
      showEndGamePopup(`It's a draw!`);
      endGame();
      return;
    }

    currentPlayer = "X";
    updateStatus(`Player ${currentPlayer}'s turn`);
  }

  cells.forEach(cell => cell.addEventListener('click', () => {
    clickSound();
    handleCellClick(event);
  }));

  playAgainBtn.addEventListener('click', () => {
    clickSound();
    restartGame();
  });

  exitBtn.addEventListener('click', () => {
    clickSound();
    // Reset UI to welcome screen:
    endGamePopup.style.display = "none";
    gameDiv.style.display = "none";
    modeSelection.style.display = "flex";
    mode = null;
    board = ["", "", "", "", "", "", "", "", ""];
    currentPlayer = "X";
    gameActive = false;
  });
</script>

</body>
</html>
