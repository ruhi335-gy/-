<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Save Photo in Browser</title>
</head>
<body>
  <h2>Upload Photo to Local Storage (IndexedDB)</h2>
  <input type="file" id="photoInput" accept="image/*">
  <br><br>
  <img id="preview" width="200" style="display:none;">
  <br><br>
  <button onclick="savePhoto()">Save to Browser</button>

  <script>
    let selectedFile;

    // Listen for file input
    document.getElementById('photoInput').addEventListener('change', function (event) {
      selectedFile = event.target.files[0];

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.getElementById('preview');
        img.src = e.target.result;
        img.style.display = 'block';
      };
      reader.readAsDataURL(selectedFile);
    });

    // Initialize IndexedDB
    const dbName = "PhotoStorageDB";
    let db;

    const request = indexedDB.open(dbName, 1);

    request.onerror = function () {
      console.error("Database failed to open");
    };

    request.onsuccess = function () {
      db = request.result;
      console.log("Database opened");
    };

    request.onupgradeneeded = function (e) {
      db = e.target.result;
      db.createObjectStore("photos", { keyPath: "id", autoIncrement: true });
      console.log("Database setup complete");
    };

    function savePhoto() {
      if (!selectedFile) {
        alert("Please choose a photo first.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const transaction = db.transaction(["photos"], "readwrite");
        const store = transaction.objectStore("photos");

        const photo = {
          name: selectedFile.name,
          dataUrl: e.target.result,
          time: new Date()
        };

        const addRequest = store.add(photo);

        addRequest.onsuccess = function () {
          alert("Photo saved in browser!");
        };

        addRequest.onerror = function () {
          console.error("Error saving photo");
        };
      };
      reader.readAsDataURL(selectedFile);
    }
  </script>
</body>
</html>
